---

# ensure additional bash functions are available on *nix systems
- name: ensure additional bash functions are present
  block:
    - ansible.builtin.file:
        path: '/usr/local/lib/bash'
        state: directory
        owner: root
        group: root
        mode: '0755'

    - ansible.builtin.get_url:
        url: 'https://raw.githubusercontent.com/g4s/collecction/master/nix/lib/{{ item }}'
        dest: '/usr/local/lib/bash/{{ item }}'
        owner: root
        group: root
        mode: '0755'
      loop:
        - 'system.sh'
  when: ansible_os_family != 'Windows'

- name: ensure hostname is set
  block:
    - ansible.builtin.hostname: {{ hostname | default('machine001')}}
      when: ansible_os_family != 'Windows'

- name: ensure system has latest pci-IDs
  ansible.builtin.command: 'update-pciids'
  when: ansible_os_family != 'Windows'

- ansible.builtin.include_tasks:
    file: './tasks/{{ ansible_os_family }}/main.yml'

# @ToDo install mergeFS --> https://github.com/trapexit/mergerfs

- name: configure ntp
  block:
    - ansible.builtin.template:
        src: ntp.conf.j2
        dest: /etc/ntp.conf
      when: ansible_os_family != 'Windows'
  when: ntp_server is defined